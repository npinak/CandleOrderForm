import { listAppVersionsByAppId } from './app-versions-service.js';
import { listApps } from './apps-service.js';
import { PromptService } from './prompt-service.js';
export const DynamicChoicesService = {
    async chooseApp() {
        const apps = await listApps();
        const appChoicesMap = {};
        for (const app of apps) {
            appChoicesMap[`${app.id} | ${app.name}`] = app.id;
        }
        const selectedAppKey = await PromptService.promptSelectionWithAutoComplete('Select an app', Object.keys(appChoicesMap));
        const selectedAppId = appChoicesMap[selectedAppKey];
        return selectedAppId;
    },
    async chooseAppVersion(appId, filterByStatus) {
        let appVersions = await listAppVersionsByAppId(appId);
        if (filterByStatus) {
            appVersions = appVersions.filter(appVersion => filterByStatus.includes(appVersion.status));
        }
        const appVersionChoicesMap = {};
        for (const appVersion of appVersions) {
            appVersionChoicesMap[`${appVersion.id} | ${appVersion.versionNumber} | ${appVersion.name} | ${appVersion.status}`] = appVersion.id;
        }
        const selectedAppVersionKey = await PromptService.promptSelectionWithAutoComplete('Select an app version', Object.keys(appVersionChoicesMap));
        const selectedAppVersionId = appVersionChoicesMap[selectedAppVersionKey];
        return selectedAppVersionId;
    },
    async chooseAppAndAppVersion(filterByStatus) {
        const appId = await this.chooseApp();
        const appVersionId = await this.chooseAppVersion(appId, filterByStatus);
        return { appId, appVersionId };
    },
};
